---
title: "Milestone 4"
author: "Bernadette Stadler"
date: "10/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggplot2)
library(readxl)
library(janitor)
library(reshape2)
library(scales)
library(plotly)
```

```{r read in data, include = FALSE}
mls_salaries <- read_excel("data/MLS_Salaries.xlsx") %>% clean_names()
```

```{r make ggplot data, include = FALSE}

# For this milestone, I put together a chart comparing the salaries of 
# professional soccer players in the Major League Soccer(MLS) league and the 
# National Women's Soccer League (NWSl). Some of the NWSL data I needed to use 
# wasn't available in a downloadable dataset, but because it is pretty minimal 
# (a 6 by 3 tibble) I was able to pull it together by hand.. 

season <- c(2013, 2014, 2015, 2016, 2017, 2018)

# make vector of seasons 

nwsl_salaries <- tibble(season) %>% 
  mutate(min_salary = c(6000, 6600, 6842, 7200, 15000, 15750)) %>% mutate(max_salary = c(30000, 31500, 37800, 39700, 41700, 44000))

# create tibble with nwsl min and max salaries 

# The rest of my data comes from the mls_salaries dataset which is quite 
# extensive and required a lot of manipulation. 

min_max_data <- mls_salaries %>% 
  select(season, base_salary) %>% 
  
  # select variables I am interested in. 
  
  filter(season >= 2013) %>% 
  
  # filter so that I am using the same seasons here as I have nwsl data for 
  
  group_by(season) %>% 
  
  # find the minimum and maximum player salaries
  
  summarize(
    min_salary = min(base_salary), 
    max_salary = max(base_salary)
    ) %>% 
  
  # join the mls data with the nwsl tibble I made above
  
  inner_join(
      nwsl_salaries, by = "season", suffix= c("_mls","_nwsl")
      ) %>% 
  clean_names() %>% 
  
  # clean names because some came through in a weird format 
  
  melt(id = "season") %>%
  mutate(league = ifelse(
    variable %in% c("max_salary_nwsl","min_salary_nwsl"), "NWSL", "MLS")
  ) %>% 
  mutate(min_max = ifelse(
    variable %in% c("max_salary_nwsl","max_salary_mls"), "Max", "Min")
  )

# format the data so that there are separate columns indicating min or max 
# salary as well as the league so that I later use these variables in my ggplot

```

```{r make ggplot, warning = FALSE, message = FALSE}

min_max_data %>% 
  select(season, value, min_max, league) %>% 
  
  # reselect variables of interest since I ended up with one superfluous column
  # when I reformatted the data above 
  
  ggplot() + 
  geom_smooth(aes(x = season, y = value, color = min_max)) + 
  
  # make the ggplot. 
  
  facet_wrap(~league) +
  
  # facet wrap by league 
  
  scale_y_log10(labels = number_format(scale = 1)) +
  
  # scale the y axis. When the y axis is not a logorithmic scale, you basically
  # can't see any lines other than the MLS maximum salary. To mitigate some of
  # the non-intuitiveness of the log scale, I changed the y axis so that values
  # are reported in numbers, not as log funcitons. 
  
    labs(
    title = "Major League Soccer and National Women's Soccer League Salaries",
    subtitle = "By season, 2013-2018",
    y = "Salary (in USD)",
    x = "Season", 
    caption = "Data from MLS Player's Association, USA soccer, and The Equalizer.",
    fill = "") +
  
  # add title and subtitle, relable where necessary 
  
  theme_minimal() +
  
  # make it look pretty 
  
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(hjust =0.5))

  # center titles and caption


```